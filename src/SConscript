import os
import sys
import platform

OS_NAME = platform.system();
LIB_DIR=os.environ['LIB_DIR'];
BIN_DIR=os.environ['BIN_DIR'];

env=DefaultEnvironment().Clone()
RIVE_CPP_FILES = [
"rive-cpp/src/generated/draw_target_base.cpp",
"rive-cpp/src/generated/backboard_base.cpp",
"rive-cpp/src/generated/animation/any_state_base.cpp",
"rive-cpp/src/generated/animation/state_machine_trigger_base.cpp",
"rive-cpp/src/generated/animation/state_machine_base.cpp",
"rive-cpp/src/generated/animation/exit_state_base.cpp",
"rive-cpp/src/generated/animation/state_machine_number_base.cpp",
"rive-cpp/src/generated/animation/state_transition_base.cpp",
"rive-cpp/src/generated/animation/keyframe_double_base.cpp",
"rive-cpp/src/generated/animation/state_machine_bool_base.cpp",
"rive-cpp/src/generated/animation/transition_bool_condition_base.cpp",
"rive-cpp/src/generated/animation/transition_trigger_condition_base.cpp",
"rive-cpp/src/generated/animation/transition_number_condition_base.cpp",
"rive-cpp/src/generated/animation/cubic_interpolator_base.cpp",
"rive-cpp/src/generated/animation/linear_animation_base.cpp",
"rive-cpp/src/generated/animation/entry_state_base.cpp",
"rive-cpp/src/generated/animation/state_machine_layer_base.cpp",
"rive-cpp/src/generated/animation/keyed_object_base.cpp",
"rive-cpp/src/generated/animation/keyframe_id_base.cpp",
"rive-cpp/src/generated/animation/keyframe_color_base.cpp",
"rive-cpp/src/generated/animation/keyed_property_base.cpp",
"rive-cpp/src/generated/animation/animation_base.cpp",
"rive-cpp/src/generated/animation/animation_state_base.cpp",
"rive-cpp/src/generated/shapes/straight_vertex_base.cpp",
"rive-cpp/src/generated/shapes/paint/radial_gradient_base.cpp",
"rive-cpp/src/generated/shapes/paint/gradient_stop_base.cpp",
"rive-cpp/src/generated/shapes/paint/solid_color_base.cpp",
"rive-cpp/src/generated/shapes/paint/trim_path_base.cpp",
"rive-cpp/src/generated/shapes/paint/linear_gradient_base.cpp",
"rive-cpp/src/generated/shapes/paint/stroke_base.cpp",
"rive-cpp/src/generated/shapes/paint/fill_base.cpp",
"rive-cpp/src/generated/shapes/polygon_base.cpp",
"rive-cpp/src/generated/shapes/cubic_detached_vertex_base.cpp",
"rive-cpp/src/generated/shapes/clipping_shape_base.cpp",
"rive-cpp/src/generated/shapes/rectangle_base.cpp",
"rive-cpp/src/generated/shapes/cubic_mirrored_vertex_base.cpp",
"rive-cpp/src/generated/shapes/star_base.cpp",
"rive-cpp/src/generated/shapes/ellipse_base.cpp",
"rive-cpp/src/generated/shapes/points_path_base.cpp",
"rive-cpp/src/generated/shapes/triangle_base.cpp",
"rive-cpp/src/generated/shapes/shape_base.cpp",
"rive-cpp/src/generated/shapes/cubic_asymmetric_vertex_base.cpp",
"rive-cpp/src/generated/artboard_base.cpp",
"rive-cpp/src/generated/draw_rules_base.cpp",
"rive-cpp/src/generated/bones/tendon_base.cpp",
"rive-cpp/src/generated/bones/skin_base.cpp",
"rive-cpp/src/generated/bones/bone_base.cpp",
"rive-cpp/src/generated/bones/weight_base.cpp",
"rive-cpp/src/generated/bones/root_bone_base.cpp",
"rive-cpp/src/generated/bones/cubic_weight_base.cpp",
"rive-cpp/src/generated/node_base.cpp",
"rive-cpp/src/draw_rules.cpp",
"rive-cpp/src/core/field_types/core_bool_type.cpp",
"rive-cpp/src/core/field_types/core_uint_type.cpp",
"rive-cpp/src/core/field_types/core_double_type.cpp",
"rive-cpp/src/core/field_types/core_string_type.cpp",
"rive-cpp/src/core/field_types/core_color_type.cpp",
"rive-cpp/src/core/binary_reader.cpp",
"rive-cpp/src/transform_component.cpp",
"rive-cpp/src/importers/artboard_importer.cpp",
"rive-cpp/src/importers/state_machine_importer.cpp",
"rive-cpp/src/importers/linear_animation_importer.cpp",
"rive-cpp/src/importers/layer_state_importer.cpp",
"rive-cpp/src/importers/keyed_object_importer.cpp",
"rive-cpp/src/importers/state_transition_importer.cpp",
"rive-cpp/src/importers/state_machine_layer_importer.cpp",
"rive-cpp/src/importers/keyed_property_importer.cpp",
"rive-cpp/src/component.cpp",
"rive-cpp/src/node.cpp",
"rive-cpp/src/layout.cpp",
"rive-cpp/src/animation/keyframe_color.cpp",
"rive-cpp/src/animation/blend_animation.cpp",
"rive-cpp/src/animation/state_machine_instance.cpp",
"rive-cpp/src/animation/blend_state_direct.cpp",
"rive-cpp/src/animation/animation_state.cpp",
"rive-cpp/src/animation/transition_trigger_condition.cpp",
"rive-cpp/src/animation/keyed_object.cpp",
"rive-cpp/src/animation/state_machine.cpp",
"rive-cpp/src/animation/blend_state_1d_instance.cpp",
"rive-cpp/src/animation/state_machine_input_instance.cpp",
"rive-cpp/src/animation/animation_state_instance.cpp",
"rive-cpp/src/animation/transition_condition.cpp",
"rive-cpp/src/animation/linear_animation.cpp",
"rive-cpp/src/animation/blend_state_direct_instance.cpp",
"rive-cpp/src/animation/linear_animation_instance.cpp",
"rive-cpp/src/animation/keyframe_double.cpp",
"rive-cpp/src/animation/blend_animation_direct.cpp",
"rive-cpp/src/animation/blend_state_transition.cpp",
"rive-cpp/src/animation/transition_number_condition.cpp",
"rive-cpp/src/animation/keyframe.cpp",
"rive-cpp/src/animation/blend_state.cpp",
"rive-cpp/src/animation/state_machine_layer.cpp",
"rive-cpp/src/animation/blend_animation_1d.cpp",
"rive-cpp/src/animation/blend_state_1d.cpp",
"rive-cpp/src/animation/state_instance.cpp",
"rive-cpp/src/animation/cubic_interpolator.cpp",
"rive-cpp/src/animation/keyed_property.cpp",
"rive-cpp/src/animation/transition_bool_condition.cpp",
"rive-cpp/src/animation/state_machine_input.cpp",
"rive-cpp/src/animation/layer_state.cpp",
"rive-cpp/src/animation/system_state_instance.cpp",
"rive-cpp/src/animation/state_transition.cpp",
"rive-cpp/src/animation/keyframe_id.cpp",
"rive-cpp/src/drawable.cpp",
"rive-cpp/src/shapes/paint/solid_color.cpp",
"rive-cpp/src/shapes/paint/linear_gradient.cpp",
"rive-cpp/src/shapes/paint/shape_paint.cpp",
"rive-cpp/src/shapes/paint/fill.cpp",
"rive-cpp/src/shapes/paint/radial_gradient.cpp",
"rive-cpp/src/shapes/paint/color.cpp",
"rive-cpp/src/shapes/paint/trim_path.cpp",
"rive-cpp/src/shapes/paint/shape_paint_mutator.cpp",
"rive-cpp/src/shapes/paint/gradient_stop.cpp",
"rive-cpp/src/shapes/paint/stroke.cpp",
"rive-cpp/src/shapes/points_path.cpp",
"rive-cpp/src/shapes/star.cpp",
"rive-cpp/src/shapes/cubic_asymmetric_vertex.cpp",
"rive-cpp/src/shapes/cubic_detached_vertex.cpp",
"rive-cpp/src/shapes/metrics_path.cpp",
"rive-cpp/src/shapes/cubic_vertex.cpp",
"rive-cpp/src/shapes/shape.cpp",
"rive-cpp/src/shapes/triangle.cpp",
"rive-cpp/src/shapes/polygon.cpp",
"rive-cpp/src/shapes/path.cpp",
"rive-cpp/src/shapes/parametric_path.cpp",
"rive-cpp/src/shapes/path_vertex.cpp",
"rive-cpp/src/shapes/rectangle.cpp",
"rive-cpp/src/shapes/straight_vertex.cpp",
"rive-cpp/src/shapes/path_composer.cpp",
"rive-cpp/src/shapes/shape_paint_container.cpp",
"rive-cpp/src/shapes/cubic_mirrored_vertex.cpp",
"rive-cpp/src/shapes/ellipse.cpp",
"rive-cpp/src/shapes/clipping_shape.cpp",
"rive-cpp/src/math/aabb.cpp",
"rive-cpp/src/math/vec2d.cpp",
"rive-cpp/src/math/mat2d.cpp",
"rive-cpp/src/dependency_sorter.cpp",
"rive-cpp/src/artboard.cpp",
"rive-cpp/src/draw_target.cpp",
"rive-cpp/src/file.cpp",
"rive-cpp/src/bones/root_bone.cpp",
"rive-cpp/src/bones/bone.cpp",
"rive-cpp/src/bones/skinnable.cpp",
"rive-cpp/src/bones/weight.cpp",
"rive-cpp/src/bones/skin.cpp",
"rive-cpp/src/bones/tendon.cpp",
]
SOURCES=Glob('base/*.c') + Glob('*.c') + Glob('*.cpp') + RIVE_CPP_FILES + Glob('rive/*.cpp');

EXPORT_DEF=''
if OS_NAME == 'Windows' and os.environ['TOOLS_NAME'] == '':
  EXPORT_DEF = ' /DEF:"src/rive.def" '

if 'BUILD_SHARED' in os.environ and os.environ['BUILD_SHARED'] == 'True':
  LIBS=['awtk'];
  LINKFLAGS=env['LINKFLAGS'] + EXPORT_DEF 
  env.SharedLibrary(os.path.join(BIN_DIR, 'rive'), SOURCES, LIBS=LIBS, LINKFLAGS=LINKFLAGS);
else:
  env.Library(os.path.join(LIB_DIR, 'rive'), SOURCES);

